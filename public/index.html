<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="favicon.ico">

  <title>Stocks Web - Anthony Lionti</title>

  <!-- Bootstrap core CSS -->

  <!--link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css"-->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/dashboard.css" rel="stylesheet">

</head>

<body>
  <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Stocks Web</a>
    <input id="box" class="form-control form-control-dark w-100" type="text" placeholder="Search for symbol ex: MSFT, TSE:TD"
      aria-label="Search">
    <ul class="navbar-nav px-3">
      <li class="nav-item text-nowrap">
        <a class="nav-link" href="#">Sign in</a>
      </li>
    </ul>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#">
                <span data-feather="home"></span>
                Dashboard <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="file"></span>
                Orders
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="shopping-cart"></span>
                Products
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="users"></span>
                Customers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="bar-chart-2"></span>
                Reports
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="layers"></span>
                Integrations
              </a>
            </li>
          </ul>

          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>My Watchlist</span>
            <a class="d-flex align-items-center text-muted" href="#">
              <span data-feather="plus-circle"></span>
            </a>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="file-text"></span>
                Current month
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="file-text"></span>
                Last quarter
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="file-text"></span>
                Social engagement
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="file-text"></span>
                Year-end sale
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
          <h1 class="h2" id="stockName">Stock Name</h1>

          <div class="btn-toolbar mb-2 mb-md-0">

            <div class="btn-group mr-2">
              <button class="btn btn-sm btn-outline-secondary" id="share">Share</button>
              <button class="btn btn-sm btn-outline-secondary" id="export">Export CSV</button>
            </div>

            <button class="btn btn-sm btn-outline-info dropdown-toggle" type="button" id="dropdownMenuButton"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span data-feather="calendar"></span>
              <span id="dropDownText">Day</span>
            </button>
            <ul id="demolist" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <li><a class="dropdown-item btn-outline-info" href="#">Day</a></li>
              <li><a class="dropdown-item btn-outline-info" href="#">Week</a></li>
              <li><a class="dropdown-item btn-outline-info" href="#">Month</a></li>
              <li><a class="dropdown-item btn-outline-info" href="#">Year</a></li>
              <li><a class="dropdown-item btn-outline-info" href="#">Full</a></li>
            </ul>
          </div>
        </div>
        <div class="progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="60"
            aria-valuemin="0" aria-valuemax="100" style="width: 10%;">Fetching Data</div>
        </div>
        <div id="chart_div"></div>
        <div class="btn-group mr-2" data-toggle="buttons">
          <label class="btn btn-sm btn-outline-primary active">
            <input type="checkbox" name="options" class="options" autocomplete="off" value="4. close" checked>
            Close
          </label>
          <label class="btn btn-sm btn-outline-success">
            <input type="checkbox" name="options" class="options" autocomplete="off" value="1. open">
            Open
          </label>
          <label class="btn btn-sm btn-outline-success">
            <input type="checkbox" name="options" class="options" autocomplete="off" value="2. high">
            High
          </label>
          <label class="btn btn-sm btn-outline-success">
            <input type="checkbox" name="options" class="options" autocomplete="off" value="3. low">
            Low
          </label>
        </div>
        <h2>Stock Statistics</h2>
        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>#</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1,001</td>
                <td>Lorem</td>
                <td>ipsum</td>
                <td>dolor</td>
                <td>sit</td>
              </tr>
              <tr>
                <td>1,002</td>
                <td>amet</td>
                <td>consectetur</td>
                <td>adipiscing</td>
                <td>elit</td>
              </tr>
              <tr>
                <td>1,003</td>
                <td>Integer</td>
                <td>nec</td>
                <td>odio</td>
                <td>Praesent</td>
              </tr>
              <tr>
                <td>1,003</td>
                <td>libero</td>
                <td>Sed</td>
                <td>cursus</td>
                <td>ante</td>
              </tr>
              <tr>
                <td>1,004</td>
                <td>dapibus</td>
                <td>diam</td>
                <td>Sed</td>
                <td>nisi</td>
              </tr>
              <tr>
                <td>1,005</td>
                <td>Nulla</td>
                <td>quis</td>
                <td>sem</td>
                <td>at</td>
              </tr>
              <tr>
                <td>1,006</td>
                <td>nibh</td>
                <td>elementum</td>
                <td>imperdiet</td>
                <td>Duis</td>
              </tr>
              <tr>
                <td>1,007</td>
                <td>sagittis</td>
                <td>ipsum</td>
                <td>Praesent</td>
                <td>mauris</td>
              </tr>
              <tr>
                <td>1,008</td>
                <td>Fusce</td>
                <td>nec</td>
                <td>tellus</td>
                <td>sed</td>
              </tr>
              <tr>
                <td>1,009</td>
                <td>augue</td>
                <td>semper</td>
                <td>porta</td>
                <td>Mauris</td>
              </tr>
              <tr>
                <td>1,010</td>
                <td>massa</td>
                <td>Vestibulum</td>
                <td>lacinia</td>
                <td>arcu</td>
              </tr>
              <tr>
                <td>1,011</td>
                <td>eget</td>
                <td>nulla</td>
                <td>Class</td>
                <td>aptent</td>
              </tr>
              <tr>
                <td>1,012</td>
                <td>taciti</td>
                <td>sociosqu</td>
                <td>ad</td>
                <td>litora</td>
              </tr>
              <tr>
                <td>1,013</td>
                <td>torquent</td>
                <td>per</td>
                <td>conubia</td>
                <td>nostra</td>
              </tr>
              <tr>
                <td>1,014</td>
                <td>per</td>
                <td>inceptos</td>
                <td>himenaeos</td>
                <td>Curabitur</td>
              </tr>
              <tr>
                <td>1,015</td>
                <td>sodales</td>
                <td>ligula</td>
                <td>in</td>
                <td>libero</td>
              </tr>
            </tbody>
          </table>
        </div>
      </main>
    </div>
  </div>
  <footer class="footer">
    <div class="container">
      <span class="text-muted">&copy Anthony Lionti</span>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="js/options.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <!--script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script-->
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
  <!-- Icons -->
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <script>
    feather.replace()
  </script>

  <!-- Graphs -->
  <script>
    var json;
    var counter = 0;
    var metaData;
    var url;
    var symbol = "MSFT";
    var range = "Day";
    var rangeName;
    var allData = new Array();
    var dataDisplay = ["4. close"];

    // Load the Visualization API and the corechart package.
    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.load('current', { packages: ['corechart', 'line'] });
    google.charts.setOnLoadCallback(getData);

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.
    function getData() {
      $(".progress").show();
      $(".progress-bar").attr("style", "width: 100%;");

      var decrypted = CryptoJS.AES.decrypt("U2FsdGVkX1/ZxD7N23BBxhOErx8gvdZGQ/E6r3hE/I4r+wSqJjyt7hYybaoaPN3U", "StockSecret").toString(CryptoJS.enc.Utf8);

      if (range == "Week") {
        rangeName = "Time Series (Daily)";
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=" + symbol + "&apikey=" + decrypted;
      } else if (range == "Month") {
        rangeName = "Time Series (Daily)";
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=" + symbol + "&apikey=" + decrypted;
      } else if (range == "Year") {
        rangeName = "Weekly Time Series";
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_WEEKLY&symbol=" + symbol + "&apikey=" + decrypted;
      } else if (range == "Full") {
        rangeName = "Monthly Time Series";
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY&symbol=" + symbol + "&apikey=" + decrypted;
      } else {
        rangeName = "Time Series (5min)";
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=" + symbol + "&interval=5min&apikey=" + decrypted;
      }

      $.ajax({
        url: url,
        dataType: 'json',
        contentType: "application/json",
        success: doChart
      });
    }

    function doChart(d) {

      var today = new Date();
      var dd = today.getDate();
      var mm = today.getMonth();
      var yyyy = today.getFullYear();

      var chartData = new Array();
      var tmp = new Array();
      var previousClose;

      allData = d;
      metaData = d["Meta Data"];

      $.each(d[rangeName], function (key, val) {
        var date = key.split(" ")[0].split("-");

        if (range == "Day") {
          var time = key.split(" ")[1].split(":");
          tmp = new Array(new Date(date[0], date[1] - 1, date[2], time[0], time[1], time[2]));

          if (date[2] == dd - 1 && time[0] == 15 && time[1] == 55) {
            previousClose = parseFloat(val["4. close"]);
          }

        } else {
          tmp = new Array(new Date(date[0], date[1] - 1, date[2]));

        }

        for (i = 0; i < dataDisplay.length; i++) {
          tmp.push(parseFloat(val[dataDisplay[i]]));
        }

        chartData.unshift(tmp);

        if (chartData.length == 0) {
          //console.log("error" + d);
        }

      });

      //if (range == "Day") {
      for (i = 0; i < chartData.length; i++) {
        chartData[i].push(previousClose);
      }
      // }


      if (range == "Day") {
        $('#stockName').text(metaData["2. Symbol"].toUpperCase() + " " + chartData[chartData.length - 1][1]);

      }

      // Create the data table.
      var data = new google.visualization.DataTable();

      data.addColumn('datetime', 'Time');

      for (i = 0; i < dataDisplay.length; i++) {
        data.addColumn('number', dataDisplay[i].substring(3, 4).toUpperCase() + dataDisplay[i].substring(4, dataDisplay[i].length));
      }

      //if (range == "Day") {
      data.addColumn('number', 'Previous Close');
      // }

      /* if (chartData.length == 0) {
        //doChart(symbol, range);
        alert("error");
        // break;
      } */
      data.addRows(chartData);

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, getChartOptions(range));
      $(".progress").hide();
    }

    //$('#box').bind("enterKey", function (e) {

    //});
    $('#box').keyup(function (e) {
      if (e.keyCode == 13) {

        symbol = $('#box').val().toUpperCase();
        range = "Day";

        $("#dropDownText").text(range);
        $(".progress-bar").attr("style", "width: 10%;");

        google.charts.load('current', { packages: ['corechart', 'line'] });

        google.charts.setOnLoadCallback(getData);
      }
    });

    $("#export").click(function () {
      location.href = 'https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=' + metaData["2. Symbol"].toUpperCase() + '&apikey=XUEAGBE7E6O2CUCH&datatype=csv';
    });

    $("#share").click(function () {

    });

    $('.options').change(function () {
      dataDisplay = [];
      $('[name=options]:checked').each(function (i) {
        dataDisplay[i] = $(this).val();
      });

      if (dataDisplay.length == 0) {

      }

      google.charts.load('current', { packages: ['corechart', 'line'] });
      google.charts.setOnLoadCallback(function () {
        doChart(allData);
      });
    });

    $('#demolist li').on('click', function () {
      range = this.textContent;
      $("#dropDownText").text(range);

      google.charts.load('current', { packages: ['corechart', 'line'] });
      google.charts.setOnLoadCallback(getData);
    });

  </script>
</body>

</html>